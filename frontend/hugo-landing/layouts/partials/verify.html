<!-- *** VERIFY EMAIL (handles ?token=xxx from email link) *** -->
<section class="contact-hero">
    <div class="contact-hero-content" style="text-align: center; max-width: 560px; margin: 0 auto;">
        <h1 class="contact-hero-title">Verifying your email...</h1>
        <p class="contact-hero-subtitle" id="verify-status">Please wait.</p>
        <p id="verify-error" style="display:none; color: #b42318; margin-top: 1rem;"></p>
    </div>
</section>

<script>
(function() {
    var params = new URLSearchParams(window.location.search);
    var token = params.get('token');
    var statusEl = document.getElementById('verify-status');
    var errEl = document.getElementById('verify-error');

    if (!token) {
        statusEl.textContent = 'Invalid or missing verification link.';
        errEl.style.display = 'block';
        errEl.textContent = 'Please use the link from your verification email.';
        return;
    }

    var API_BASE = window.HEERISE_API_BASE || 'http://localhost:8000';
    fetch(API_BASE + '/auth/verify-email?token=' + encodeURIComponent(token))
        .then(function(r) {
            if (!r.ok) return r.json().then(function(d) { throw new Error(d.detail || 'Verification failed'); });
            return r.json();
        })
        .then(function(data) {
            if (data.access_token && data.refresh_token) {
                localStorage.setItem('access', data.access_token);
                localStorage.setItem('refresh', data.refresh_token);
            }
            statusEl.textContent = 'Email verified! Logging you in...';
            window.location.href = data.next || '/acc/';
        })
        .catch(function(err) {
            statusEl.textContent = 'Verification failed.';
            errEl.style.display = 'block';
            errEl.textContent = err.message || 'Please try again or request a new verification email.';
        });
})();
</script>
<!-- *** VERIFY END *** -->
